<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>Nouvelle Commande</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div th:replace="~{fragments/navbar :: nav}"></div>

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header">
                    <h3>Créer une nouvelle commande</h3>
                </div>
                <div class="card-body">
                    <form th:action="@{/orders/create}" method="post">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="table" class="form-label">Table</label>
                                <select id="table" name="tableId" class="form-select" required>
                                    <option value="">-- Choisir une table disponible --</option>
                                    <option th:each="tableRestaurant : ${tables}" th:value="${tableRestaurant.identifiant}" th:text="'Table ' + ${tableRestaurant.numeroTable} + ' (' + ${tableRestaurant.nombrePersonne} + ' places)'"></option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="clientEmail" class="form-label">Email du Client (optionnel)</label>
                                <input type="email" id="clientEmail" name="clientEmail" class="form-control" placeholder="Laissez vide pour le client 'Invité'">
                            </div>
                        </div>

                        <!-- ========================================================== -->
                        <!--     DEUX LISTES SÉPARÉES POUR PLATS ET BOISSONS          -->
                        <!-- ========================================================== -->
                        <div class="mb-3">
                            <label for="plats" class="form-label">Plats Cuisinés & Desserts</label>
                            <!-- Note: le 'name' est le même pour que Spring les regroupe -->
                            <select id="plats" name="platIds" class="form-select" multiple size="8">
                                <option th:each="plat : ${platsCuisines}" th:value="${plat.identifiant}" th:text="${plat.nom} + ' - ' + ${plat.prix} + '€'"></option>
                            </select>
                            <small class="form-text text-muted">Maintenez la touche Ctrl (ou Cmd sur Mac) pour sélectionner plusieurs plats.</small>
                        </div>

                        <div class="mb-3">
                            <label for="boissons" class="form-label">Boissons</label>
                            <!-- Note: le 'name' est aussi "platIds" -->
                            <select id="boissons" name="platIds" class="form-select" multiple size="5">
                                <option th:each="boisson : ${boissons}" th:value="${boisson.identifiant}" th:text="${boisson.nom} + ' - ' + ${boisson.prix} + '€'"></option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="menus" class="form-label">Menus</label>
                            <select id="menus" name="menuIds" class="form-select" multiple size="5">
                                <option th:each="menu : ${menus}" th:value="${menu.id}" th:text="${menu.nom} + ' - ' + ${menu.prix} + '€'"></option>
                            </select>
                        </div>

                        <!-- ========================================================== -->
                        <!--     BOUTON PRÉCÉDENT AJOUTÉ                            -->
                        <!-- ========================================================== -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                            <a th:href="@{/orders}" class="btn btn-secondary me-md-2">
                                <i class="bi bi-arrow-left"></i> Précédent
                            </a>
                            <button type="submit" class="btn btn-primary">Créer la Commande</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>