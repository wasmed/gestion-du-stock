<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>Nouvelle Commande | RestoApp</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <style>
        .btn-check:checked + .btn-outline-primary {
            background-color: #0d6efd;
            color: white;
            border-color: #0d6efd;
        }
        .card-check {
            cursor: pointer;
            transition: transform 0.2s;
        }
        .card-check:hover {
            transform: translateY(-2px);
        }
        .form-check-input:checked ~ .card {
            border-color: #0d6efd !important;
            background-color: #e7f1ff !important;
        }
    </style>
</head>
<body class="bg-light">
<div th:replace="~{fragments/navbar :: nav}"></div>

<div class="container-fluid py-4">
    <div class="mb-4">
        <h2 class="fw-bold">Nouvelle Commande</h2>
        <p class="text-muted">Sélectionnez une table et ajoutez des articles.</p>
    </div>

    <form th:action="@{/orders/create}" method="post">
        <div class="row">
            <!-- LEFT COLUMN: SELECTION -->
            <div class="col-lg-8">

                <!-- TABLE SELECTION -->
                <div class="card shadow-sm mb-4 border-0">
                    <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                        <h5 class="mb-0 fw-bold text-primary"><i class="bi bi-shop me-2"></i>1. Choisir une Table</h5>
                    </div>
                    <div class="card-body px-4 pb-4">
                        <div th:if="${tables.isEmpty()}" class="alert alert-warning">
                            Aucune table disponible.
                        </div>
                        <div class="row row-cols-2 row-cols-md-4 row-cols-xl-5 g-3">
                            <div th:each="table : ${tables}" class="col">
                                <input type="radio" name="tableId" th:value="${table.identifiant}" th:id="'table-'+${table.identifiant}" class="btn-check" required>
                                <label th:for="'table-'+${table.identifiant}" class="btn btn-outline-secondary w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3 shadow-sm border-2">
                                    <i class="bi bi-square fs-1 mb-2"></i>
                                    <span class="fw-bold fs-5">Table <span th:text="${table.numeroTable}"></span></span>
                                    <small class=""><span th:text="${table.nombrePersonne}"></span> places</small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ITEMS SELECTION -->
                <div class="card shadow-sm border-0">
                    <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                        <h5 class="mb-0 fw-bold text-primary"><i class="bi bi-basket2 me-2"></i>2. Choisir les Articles</h5>
                    </div>
                    <div class="card-body px-4 pb-4">
                        <ul class="nav nav-pills mb-4" id="pills-tab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active rounded-pill px-4" id="pills-plats-tab" data-bs-toggle="pill" data-bs-target="#pills-plats" type="button" role="tab">
                                    <i class="bi bi-egg-fried me-2"></i>Plats Cuisinés
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link rounded-pill px-4" id="pills-boissons-tab" data-bs-toggle="pill" data-bs-target="#pills-boissons" type="button" role="tab">
                                    <i class="bi bi-cup-straw me-2"></i>Boissons
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link rounded-pill px-4" id="pills-menus-tab" data-bs-toggle="pill" data-bs-target="#pills-menus" type="button" role="tab">
                                    <i class="bi bi-journal-text me-2"></i>Menus
                                </button>
                            </li>
                        </ul>

                        <div class="tab-content" id="pills-tabContent">
                            <!-- PLATS -->
                            <div class="tab-pane fade show active" id="pills-plats" role="tabpanel">
                                <div class="row row-cols-1 row-cols-md-3 g-3">
                                    <div th:each="plat : ${platsCuisines}" class="col">
                                        <div class="position-relative">
                                            <input class="form-check-input position-absolute top-0 start-0 m-2 z-1" type="checkbox" name="platIds" th:value="${plat.identifiant}" th:id="'plat-'+${plat.identifiant}" style="transform: scale(1.3);">
                                            <label class="card h-100 border-0 shadow-sm card-check" th:for="'plat-'+${plat.identifiant}">
                                                <div class="card-body d-flex flex-column pt-4">
                                                    <span class="fw-bold mb-2" th:text="${plat.nom}"></span>
                                                    <div class="mt-auto text-end text-primary fw-bold fs-5">
                                                        <span th:text="${plat.prix} + ' €'"></span>
                                                    </div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- BOISSONS -->
                            <div class="tab-pane fade" id="pills-boissons" role="tabpanel">
                                 <div class="row row-cols-1 row-cols-md-3 g-3">
                                    <div th:each="boisson : ${boissons}" class="col">
                                        <div class="position-relative">
                                            <input class="form-check-input position-absolute top-0 start-0 m-2 z-1" type="checkbox" name="platIds" th:value="${boisson.identifiant}" th:id="'boisson-'+${boisson.identifiant}" style="transform: scale(1.3);">
                                            <label class="card h-100 border-0 shadow-sm card-check" th:for="'boisson-'+${boisson.identifiant}">
                                                <div class="card-body d-flex flex-column pt-4">
                                                    <span class="fw-bold mb-2" th:text="${boisson.nom}"></span>
                                                    <div class="mt-auto text-end text-primary fw-bold fs-5">
                                                        <span th:text="${boisson.prix} + ' €'"></span>
                                                    </div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- MENUS -->
                            <div class="tab-pane fade" id="pills-menus" role="tabpanel">
                                <div class="row row-cols-1 row-cols-md-2 g-3">
                                    <div th:each="menu : ${menus}" class="col">
                                        <div class="position-relative">
                                            <input class="form-check-input position-absolute top-0 start-0 m-2 z-1" type="checkbox" name="menuIds" th:value="${menu.id}" th:id="'menu-'+${menu.id}" style="transform: scale(1.3);">
                                            <label class="card h-100 border-0 shadow-sm card-check" th:for="'menu-'+${menu.id}">
                                                <div class="card-body d-flex flex-column pt-4">
                                                    <span class="fw-bold mb-2" th:text="${menu.nom}"></span>
                                                    <div class="mt-auto text-end text-primary fw-bold fs-5">
                                                        <span th:text="${menu.prix} + ' €'"></span>
                                                    </div>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN: SUMMARY & SUBMIT -->
            <div class="col-lg-4">
                 <div class="card shadow border-0 sticky-top" style="top: 20px; z-index: 100;">
                    <div class="card-header bg-primary text-white py-3">
                        <h5 class="mb-0 fw-bold"><i class="bi bi-receipt me-2"></i>Résumé</h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="mb-4">
                            <label for="clientEmail" class="form-label fw-bold">Client (Email)</label>
                             <div class="input-group">
                                <span class="input-group-text bg-white"><i class="bi bi-envelope"></i></span>
                                <input type="email" id="clientEmail" name="clientEmail" class="form-control" placeholder="guest@resto.com">
                             </div>
                             <div class="form-text">Laisser vide pour "Invité"</div>
                        </div>

                        <div class="mb-4">
                            <label for="commentaire" class="form-label fw-bold">Note pour le serveur</label>
                            <textarea id="commentaire" name="commentaire" class="form-control" rows="3" placeholder="Allergies, préférences, etc."></textarea>
                        </div>

                        <div class="alert alert-light border small text-muted">
                            <i class="bi bi-info-circle me-1"></i> Sélectionnez les articles dans la liste à gauche.
                        </div>

                        <hr>

                        <div class="d-grid gap-3">
                            <button type="submit" class="btn btn-success btn-lg fw-bold shadow-sm">
                                <i class="bi bi-check-lg me-2"></i>Valider la Commande
                            </button>
                            <a th:href="@{/orders}" class="btn btn-outline-secondary">
                                <i class="bi bi-x-lg me-2"></i>Annuler
                            </a>
                        </div>
                    </div>
                 </div>
            </div>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
